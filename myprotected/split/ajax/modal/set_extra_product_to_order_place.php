<?php 	//********************	//** WEB INSPECTOR	//********************		require_once "../../../require.base.php";		require_once "../../library/AjaxHelp.php";		$ah = new ajaxHelp($dbh);		$order_id	= (int)$_POST['order_id'];		$action = (isset($_POST['action']) ? $_POST['action'] : "open");	$r = array('status'=>'success','message'=>'Товар успешно добавлен','articel'=>0);			switch($action)	{		case 'add':			$ref_id		= (int)$_POST['ref_id'];			$extra_quantity	= (int)$_POST['extra_quantity'];									$q = "SELECT * FROM [pre]o_orders_extras WHERE `extra_kind_id`='$ref_id' AND `order_id`='$order_id' LIMIT 1";			$extraKindRef = $ah->dbh->q($q,1);						if($extraKindRef) // update			{				$q = "UPDATE [pre]o_orders_extras SET `quantity`='$extra_quantity' WHERE `extra_kind_id`='$ref_id' AND `order_id`='$order_id' LIMIT 1";				$items = $ah->dbh->q($q,0,1);			}else // insert			{				$q = "SELECT * FROM [pre]o_extras_kinds WHERE `id`='$ref_id' LIMIT 1";				$extra = $ah->dbh->q($q,1);								if($extra){					$price = $extra['price'];					$amount = floor($price * $extra_quantity);										$q = "INSERT INTO [pre]o_orders_extras (`order_id`, `extra_kind_id`, `quantity`, `amount`) VALUES ('$order_id', '$ref_id', '$extra_quantity', '$amount')";					$items = $ah->dbh->q($q,0,1);				}			}						echo json_encode($r); exit();			break;		default:break;	}		$q = "SELECT * FROM [pre]o_extras_kinds WHERE 1 LIMIT 50";	$items = $ah->dbh->q($q);		$select_html = $ah->print_select(									"Выбрать экстра товар", 									0, 									$items,									'id', 									'title', 									"modal_extra_id", 									"", // on change  									array( 'name'=>'-- ТОВАР не выбран --', 'id'=>0 ),									'',									'float:left; width:55%; padding: 0 10px;',									'width:100%;'									); $select_html .= $ah->print_input("Set quantiry","modal_extra_quant","Quantity",1,$size=25,$onchange="",$input_type="number");  ?><!DOCTYPE><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>SET EXTRA PRODUCT TO ORDER PLACE SCRIPT</title></head><body>	<button class="close-modal" onClick="close_modal();">Закрыть окно</button>    <div class="modalW" id="modalW-1">    	<h4>Выберите EXTRA PRODUCT, система автоматически его добавит</h4>                <?php        // echo "<pre>"; print_r($items); echo "</pre>";		echo $select_html;		?>                <button class="btn btn-primary" type="button" onClick="save_extra_product_to_order_place(<?= $order_id ?>, $('#save-modal_extra_id').val(), $('#save-modal_extra_quant').val());" style="margin-top: 40px; padding: 6px 30px;">Add</button>                <div id="set_extra_product_response"></div>    </div></body></html>